!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1);t.getCache=r.getCache,function(){r.getCache()}()},function(e,t,n){"use strict";function r(e){l=e}function i(e,n){return void 0===e&&(e="one"),void 0===n&&(n=o.defaultConfig),t.config||t.instances||(t.config=o.configure(n)),t.instances||(t.instances={}),t.instances[e]||(t.instances[e]=a(e)),window&&void 0===window[e]&&(window[e]=t.instances[e]),t.instances[e]}function a(e){var t=new f.default(e),n=function(){t.reset()},r=function(e){return u.putItem(e,t)},i=function(e,n){return d.getItem(e,t,n)},a=function(e,n){return d.getEditItem(e,t,n)},o=function(e){return h.evictItem(e,t)},p=function(){return s.cacheSize(t)},g=function(){return s.cacheLength(t)},m=function(){return c.printCache(t)},v=function(e){var n=d.getCachedItem(e,t);return n.mapFrom},y=function(e){var n=d.getCachedItem(e,t);return n.mapTo},O={put:r,get:i,getEdit:a,evict:o,reset:n,size:p,length:g,print:m,refTo:y,refFrom:v};return l===!1&&(delete O.refTo,delete O.refFrom),O}var o=n(2),u=n(3),c=n(14),f=n(15),s=n(7),d=n(11),h=n(18),l=!1;t.setTesting=r,t.getCache=i},function(e,t){"use strict";function n(e){for(var n in t.defaultConfig)t.defaultConfig.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(t.defaultConfig[n]=e[n]);return t.defaultConfig}t.defaultConfig={uidName:"uid",maxHistoryStates:1e3},t.configure=n},function(e,t,n){"use strict";var r=n(4),i=n(6),a=n(7),o=n(9),u=n(10);t.putItem=function(e,t){if(a.isArray(e)||a.isObject(e)){var n=new r.default,f=new r.default;f.__UPDATED__=!1;var s={entity:e,flushMap:f,evictMap:n,parentUid:null,refPath:"",instance:t};if(u.buildFlushMap(s),o.updatePointers(s),s.flushMap.size()>0&&f.__UPDATED__===!0)return c(s)}return i.getCallStats(!1,t)};var c=function(e){return u.preFlush(e),i.getCallStats(!0,e.instance)}},function(e,t,n){"use strict";var r=n(5),i=function(){function e(){var t=this;this.paths={},this.length=0,this.get=function(e){return t.paths[e]},this.delete=function(e){if("undefined"!=typeof t.paths[e]&&t.length>0){var n=t.paths[e];return delete t.paths[e],t.length--,n}},this.has=function(e){return"undefined"!=typeof t.paths[e]},this.forEach=function(e){for(var n in t.paths)t.paths.hasOwnProperty(n)&&e(n,t.paths[n])},this.clone=function(){var n=r({},t.paths),i=new e;return i.paths=n,i.length=t.length,i}}return e.prototype.set=function(e,t){return"undefined"==typeof this.paths[e]?(this.length++,this.paths[e]=t,!0):(this.paths[e]=t,!1)},e.prototype.size=function(){return this.length},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function r(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}var i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=r()?Object.assign:function(e,t){for(var r,o,u=n(e),c=1;c<arguments.length;c++){r=Object(arguments[c]);for(var f in r)i.call(r,f)&&(u[f]=r[f]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(r);for(var s=0;s<o.length;s++)a.call(r,o[s])&&(u[o[s]]=r[o[s]])}}return u}},function(e,t,n){"use strict";function r(e){var t=e.thread.nodes[e.thread.current];return t>=0?i(t,e):void 0}function i(e,t){return t.repo.get(e)}function a(e,t){for(var n,r,i=0,a=e.length-1;i<=a;)if(n=(i+a)/2|0,r=e[n],r<t)i=n+1;else{if(!(r>t))return n;a=n-1}}var o=n(7);t.getCallStats=function(e,n){var r={};return r.success=e,r.nodeId=t.node(n),r.length=u(n),r.name=n.name,r},t.node=function(e,n){if("undefined"==typeof n){var u=r(e);return u?u.id:-1}if(!o.isNumber(n))throw new TypeError("The node id must be a number.");var c=i(n,e);return c?(e.thread.current=a(e.thread.nodes,n),t.getCallStats(!0,e)):t.getCallStats(!1,e)},t.getCurrentNode=r,t.getRepoNode=i;var u=function(e){return e.thread.nodes.length}},function(e,t,n){"use strict";function r(e){return"number"==typeof e||"[object Number]"===y(e)}function i(e){return"string"==typeof e||"[object String]"===y(e)}function a(e){return"[object Array]"!==Object.prototype.toString.call(e)&&(null!==e&&"object"==typeof e)}function o(e){return!(!e||null===e)&&(Array.isArray(e)||e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice&&!e.propertyIsEnumerable("length"))}function u(e){return Object.prototype.toString.call(e)}function c(e){return a(e)&&"[object Date]"===u(e)}function f(e){if(!e)return!0;if(o(e)&&0===e.length)return!0;if(!i(e)){for(var t in e)if(O.call(e,t))return!1;return!0}return!1}function s(e){var t=new g.CacheNode(e.nextNodeKey);return t.id=e.nextNodeKey,e.nextNodeKey+=1,e.repo.add(t),t}function d(e){if(!e)return!1;if(!a(e))return!1;if("undefined"==typeof e[p.config.uidName])return!1;var t=e[p.config.uidName];return 0!==t.length}function h(e,t,n){if(void 0===n&&(n=!0),!e||!a(e)&&!o(e))return e;if(n===!0&&t&&!Object.isFrozen(t)&&Object.freeze(t),t&&d(e)&&e[p.config.uidName]===t[p.config.uidName])return t;var r=v({},e);for(var i in e){var u=e[i];if(u)if(o(u))r[i]=l(u,t,n);else if(c(u)){var f=new Date(u.getTime());n===!0&&Object.freeze(f),r[i]=f}else a(u)?d(u)?(r[i]=u,t&&d(t)&&u!==t&&u.uid===t.uid&&u!==t&&(r[i]=t)):r[i]=h(u,t,n):(console.log(u),r[i]=u)}return n!==!0||Object.isFrozen(r)||Object.freeze(r),r}function l(e,t,n){return e.map(function(e){return o(e)?l(e,t,n):a(e)?d(e)?t&&e[p.config.uidName]===t[p.config.uidName]?t:e:h(e,t,n):e})}var p=n(1),g=n(8),m=n(6),v=n(5),y=Object.prototype.toString,O=Object.prototype.hasOwnProperty;t.isNumber=r,t.isString=i,t.isObject=a,t.isArray=o,t.isDate=c,t.isEmpty=f,t.getNewCacheNode=s,t.hasUid=d,t.deepClone=h,t.cacheSize=function(e){var t=m.getCurrentNode(e);return t?t.items.size():0},t.cacheLength=function(e){return e.thread.nodes.length}},function(e,t,n){"use strict";var r=n(4),i=function(){function e(e){this.items=new r.default,this.id=e}return e}();t.CacheNode=i},function(e,t,n){"use strict";var r=n(10),i=n(1),a=n(12),o=n(11),u=n(7);t.assignRefToParent=function(e,t){if(t.parentUid){var n=r.getItemFlushOrCached(t.parentUid,t);n&&t.refPath&&c(n,e,t.refPath)}};var c=function(e,t,n){var r=e.entity[i.config.uidName],a=t.entity[i.config.uidName];f(e,a,n),s(t,r,n)},f=function(e,t,n){e.mapTo.has(t)===!1&&e.mapTo.set(t,[]);var r=e.mapTo.get(t);return r.indexOf(n)<0&&r.push(n),e},s=function(e,t,n){e.mapFrom.has(t)===!1&&e.mapFrom.set(t,[]);var r=e.mapFrom.get(t);return r.indexOf(n)<0&&r.push(n),e};t.updatePointers=function(e){e.flushMap.forEach(function(n,r){d(r,e),t.updateRefFroms(r,e)})},t.updateRefFroms=function(e,t){console.log("UPDATE REF FROMS",e),e.mapFrom.forEach(function(n,i){var c=t.flushMap.get(n);if(c||(c=o.getCachedItem(n,t.instance)),c&&i.length>0){var f=i[0],s=a.get(c.entity,f),d=s&&s!==e.entity;if(d===!0){var h={entity:c.entity,flushMap:t.flushMap,instance:t.instance};c=r.ensureItem(h),c.entity=u.deepClone(c.entity,e.entity,!0)}}})},t.updateRefTos=function(e,t){var n=r.getItemFlushOrCached(e,t);d(n,t)};var d=function(e,t){console.log("UPDATE REF TOS",e),e&&e.mapTo.forEach(function(n,r){console.log("ITERATING",n);var o=r.map(function(r){var o=a.get(e.entity,r);if(o){var u=o[i.config.uidName];if(u){var c=u==n;if(c===!0)return r}}h(e.entity[i.config.uidName],n,t)}).filter(function(e){return null!==e&&void 0!==e});o.length>0?e.mapTo.set(n,o):e.mapTo.delete(n)})},h=function(e,t,n){var i=r.getItemFlushOrCached(t,n);i&&(i=i.clone(),i.mapFrom.has(e)&&(l(i,e,n.refPath),0===i.mapFrom.size()?(n.evictMap.set(t,i),n.flushMap.delete(t)):(n.flushMap.set(t,i),n.evictMap.delete(t))))},l=function(e,t,n){var r=e.mapFrom.get(t),i=r.indexOf(n);r=r.slice(),r.splice(i,1),e.mapFrom.set(t,r),0==r.length&&e.mapFrom.delete(t)}},function(e,t,n){"use strict";var r=n(11),i=n(1),a=n(7),o=n(12),u=n(13),c=n(4),f=n(9);t.buildFlushMap=function(e){a.hasUid(e.entity)?s(e):a.isArray(e.entity)?l(e):h(e)};var s=function(e){e.refPath="",m(e)===!0&&(d(e),h(e),f.updateRefTos(String(e.entity[i.config.uidName]),e))},d=function(e){var n=String(e.entity[i.config.uidName]);e.flushMap.has(n)===!1&&(t.ensureItem(e),e.parentUid=String(n))},h=function(e){var t=e.entity;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];(a.isObject(r)||a.isArray(r))&&(e.entity=r,t[i.config.uidName]&&(e.parentUid=t[i.config.uidName]),e.parentUid&&(e.refPath=o.concatProp(e.refPath,n)),e.refPath||(e.refPath=n)),a.isArray(r)?l(e):a.isObject(r)&&p(e),Object.freeze(r)}},l=function(e){var t,n=e.entity,r=e.refPath;t||(t=e.parentUid),n.forEach(function(n,i){e.entity=n,e.parentUid=t,(e.refPath||r)&&(e.refPath=r+"."+i),a.isArray(n)?l(e):a.isObject(n)&&p(e)}),Object.freeze(n)},p=function(e){a.hasUid(e.entity)?g(e):h(e)},g=function(e){var n=t.ensureItem(e);f.assignRefToParent(n,e);var i=r.isOnCache(e);i!==!0&&t.buildFlushMap(e)},m=function(e){var t=r.getCachedItem(e.entity[i.config.uidName],e.instance);return!t||t.entity!==e.entity};t.getItemFlushOrCached=function(e,t){if(e){e=String(e);var n=t.flushMap.get(e);return n||(n=r.getCachedItem(e,t.instance)),n&&Object.isFrozen(n)&&(n=n.clone()),n}},t.ensureItem=function(e){var t=String(e.entity[i.config.uidName]),n=e.flushMap.get(t);if(n)return n;var a=r.getCachedItem(t,e.instance);return n=new u.default(e.entity,a),e.flushMap.set(t,n),e.flushMap.__UPDATED__=!0,n},t.preFlush=function(e){var n=new c.default,a=r.getCacheCurrentStack(e.instance);a&&a.forEach(function(e,t){n.set(e,t)}),e.flushMap.forEach(function(e,t){var r=t.entity[i.config.uidName];v(t),n.set(String(r),t)}),e.evictMap.size()>0&&e.evictMap.forEach(function(e,t){n.delete(String(e))}),t.flush(n,e.instance)};var v=function(e){Object.freeze(e),Object.freeze(e.entity),Object.freeze(e.mapTo),Object.freeze(e.mapFrom)};t.flush=function(e,t){if(null!==e){Object.freeze(e);var n=a.getNewCacheNode(t);n.items=e,t.thread.nodes.indexOf(n.id)<0&&(t.thread.nodes.push(n.id),t.thread.current+=1)}}},function(e,t,n){"use strict";function r(e){var t=e.thread.nodes[e.thread.current];return t>=0?i(t,e.repo):void 0}function i(e,t){return t.get(e)}var a=n(1),o=n(7);t.getItem=function(e,t,n){if(!e)throw new TypeError("One get(): requires a uid to retrieve an item from the cache.");return o.isArray(e)?e.map(function(e){return u(e,t)}).filter(function(e){return null!==e&&void 0!==e}):u(e,t)};var u=function(e,n){var r=f(e);if(r){var i=t.getCachedItem(r,n);return i?i.entity:void 0}};t.getEditItem=function(e,t,n){return o.isArray(e)?e.map(function(e){return c(e,t)}).filter(function(e){return null!==e&&void 0!==e}):c(e,t)};var c=function(e,n){var r=f(e),i=t.getItem(r,n);return i?o.deepClone(i,void 0,!1):void 0},f=function(e){return"string"==typeof e?e:"number"==typeof e?String(e):o.isObject(e)&&o.hasUid(e)?e[a.config.uidName]:void 0};t.isOnCache=function(e){var n=e.entity[a.config.uidName],r=t.getCachedItem(n,e.instance);return r&&r.entity===e.entity},t.getCachedItem=function(e,t){var n=r(t);return n?n.items.get(String(e)):void 0},t.getCacheCurrentStack=function(e){var t=r(e);return t?t.items:void 0}},function(e,t,n){"use strict";function r(e){var t=parseInt(e);return t.toString()===e?t:e}function i(e,t){if(o.isNumber(t)&&(t=[t]),!o.isEmpty(e)){if(o.isEmpty(t))return e;if(o.isString(t))return i(e,t.split("."));var n=r(t[0]),a=e[n];if(1===t.length)void 0!==a&&(o.isArray(e)?e.splice(n,1):delete e[n]);else if(void 0!==e[n])return i(e[n],t.slice(1));return e}}function a(e,t,n){if(o.isNumber(t)&&(t=[t]),o.isEmpty(t))return e;if(o.isEmpty(e))return n;if(o.isString(t))return a(e,t.split("."),n);var i=r(t[0]);return 1===t.length?void 0===e[i]?n:e[i]:a(e[i],t.slice(1),n)}var o=n(7);t.del=i,t.get=a,t.concatProp=function(e,t){return console.log("CONCAT PROP",e,t),e=""===e?t:e+"."+t}},function(e,t,n){"use strict";var r=n(4),i=function(){function e(t,n){var i=this;this.clone=function(){return new e(i.entity,i)},this.entity=t,n?(this.mapFrom=n.mapFrom.clone(),this.mapTo=n.mapTo.clone()):(this.mapFrom=new r.default,this.mapTo=new r.default)}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var r=n(1);t.printCache=function(e){var t="",n=0,a=e.thread.current,o=e.thread.nodes;return o.map(function(r){var o=e.repo.get(r),u="",c=n+":"+u+"["+i(o.items)+"]\n\n";n===a&&(c="-> "+c),t+=c,n++}),t=t.substring(0,t.length-2),n=0,"\n------ One -------\nSTACK:\n"+t+"\n\nCONFIG:"+JSON.stringify(r.config,null,2)+"\n\nREPO SIZE:"+e.repo.length+"\n===================\n"};var i=function(e){var t="";return e.forEach(function(e,n){var r=JSON.stringify(n,null,2);t+=r+",\n"}),t}},function(e,t,n){"use strict";var r=n(16),i=n(17),a=function(){function e(e){var t=this;this.repo=new r.default,this.thread=new i.default,this.nextNodeKey=0,this.reset=function(){t.repo=new r.default,t.thread=new i.default,t.nextNodeKey=0},this.addNode=function(e){return!!t.repo.add(e)&&(t.thread.addNode(e.id),t.nextNodeKey++,!0)},this.length=function(){return t.thread.nodes.length},this.size=function(){return t.repo.length},this.name=e}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var r=n(4),i=function(){function e(){var e=this;this.items=new r.default,this.length=0,this.get=function(t){return e.items.get(t)},this.add=function(t){return!e.items.has(t.id)&&(e.items.set(t.id,t),e.length++,!0)},this.delete=function(t){e.items.has(t)&&(e.items.delete(t),e.length--)}}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t){"use strict";var n=function(){function e(){var e=this;this.current=-1,this.nodes=[],this.addNode=function(t){e.nodes.push(t),e.current++}}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var r=n(7),i=n(1),a=n(11),o=n(4),u=n(12),c=n(10),f=n(6),s=n(9);t.evictItem=function(e,t){var n=m(e);if(0==n.length)return f.getCallStats(!1,t);var r=a.getCacheCurrentStack(t),i=n.some(function(e){return r&&r.has(String(e))});if(!i)return f.getCallStats(!1,t);var u=new o.default;r.forEach(function(e,t){u.set(e,t)});var s=new o.default,l=new o.default,g={flushMap:s,evictMap:l,instance:t},v=[];return console.log(n),n.forEach(function(e){g.entityUid=e,h(g),l.set(e,null),p(n,v,g)}),d(v,s,l,t),console.log(v),s.forEach(function(e,t){u.set(e,t)}),l.forEach(function(e,t){u.delete(e)}),c.flush(u,t),f.getCallStats(!0,t)};var d=function(e,t,n,i){if(e&&e.length>0&&r.cacheSize(i)>0){var a={flushMap:t,evictMap:n,instance:i};c.buildFlushMap(a),a.flushMap.forEach(function(e,t){s.updateRefFroms(t,a)})}},h=function(e){var t=a.getCachedItem(e.entityUid,e.instance);t&&t.mapTo.forEach(function(t,n){var r=c.getItemFlushOrCached(t,e);r&&(l(r,e.entityUid),0===r.mapFrom.size()?(e.entityUid=t,h(e),e.evictMap.set(t,r)):e.flushMap.set(t,r))})},l=function(e,t){var n=e.mapFrom.get(t);n&&(e.mapFrom=e.mapFrom.clone(),e.mapFrom.delete(t))},p=function(e,t,n){var r=c.getItemFlushOrCached(n.entityUid,n);r&&r.mapFrom.forEach(function(r,i){var a=c.getItemFlushOrCached(r,n);if(a){var o=g(a,n.entityUid,n.instance);o===!0&&(n.flushMap.set(r,a),e.indexOf(r)<0&&t.push(a))}})},g=function(e,t,n){var r=e.entity;Object.isFrozen(r)&&(r=a.getEditItem(r[i.config.uidName],n),e.entity=r);var o=e.mapTo.get(t);return o.forEach(function(e){u.del(r,e)}),Object.isFrozen(r)||Object.freeze(r),e.entity=r,e.mapTo=e.mapTo.clone(),e.mapTo.delete(t),!0},m=function(e){var t=[];if(r.isArray(e))e.forEach(function(e){r.hasUid(e)?t.push(String(e[i.config.uidName])):"string"!=typeof e&&"number"!=typeof e||t.push(String(e))});else{var n=e;if(r.isObject(e)&&(n=e[i.config.uidName]),void 0===n)return t;t.push(String(n))}return t};t.clearNext=function(e){var t=e.thread;if(t.current<t.nodes.length-1){var n=t.nodes.slice(t.current+1,t.nodes.length);t.nodes=t.nodes.slice(0,t.current+1),t.current=t.nodes.length-1,v(n,e)}};var v=function(e,t){e.forEach(function(e){var n=t.repo.get(e);n&&t.repo.delete(e)})}}]);